# [include fluidd.cfg]
# For the ZNP Robin Nano DW v2.2 board:
#   - Compile with the processor model STM32F401.
#   - Select the 32KiB bootloader,
#   - Select (Serial (on # USART1 PA10/PA9) for the communication interface.
#   - Select (Serial (on # USART2 PA3/PA2) if you want to use the serial UART pins on J17 (wifi section)
# Note that the "make flash" command does not work with ZNP Robin boards. After running "make", run the following command:
# cp out/klipper.bin out/ZNP_ROBIN_NANO.bin
#
# Copy the file out/ZNP_ROBIN_NANO.bin to an SD card and then restart the printer with that SD card.
# See docs/Config_Reference.md for a description of parameters.

# This file contains all settings for KAMP, and must be included in printer.cfg with:
[exclude_object]
[include KAMP_Settings.cfg]
#[include ./KAMP/Adaptive_Meshing.cfg]       # Include to enable adaptive meshing configuration.
[include ./KAMP/Line_Purge.cfg]             # Include to enable adaptive line purging configuration.
[include macros.cfg]
[include timelapse.cfg]
# [include ./probes/stock.cfg]
# [include ./probes/eddy.cfg]
[include ./probes/eddyng.cfg]
# Uncomment when calibrating Input Shaper
#[include PIS.cfg]

[virtual_sdcard]
path: ~/printer_data/gcodes

[pause_resume]

[display_status]

[force_move]
enable_force_move: True

[safe_z_home]
home_xy_position: 160, 160
z_hop: 20

[axis_twist_compensation]
calibrate_start_x: 20
calibrate_end_x: 290
calibrate_y: 160
calibrate_start_y: 20
calibrate_end_y: 300
calibrate_x: 160

[idle_timeout]
#gcode:
#   A list of G-Code commands to execute on an idle timeout. See
#   docs/Command_Templates.md for G-Code format. The default is to run
#   "TURN_OFF_HEATERS" and "M84".
timeout: 1800
#   Idle time (in seconds) to wait before running the above G-Code
#   commands. The default is 600 seconds.

[gcode_arcs]
resolution: 0.4
#   An arc will be split into segments. Each segment's length will
#   equal the resolution in mm set above. Lower values will produce a
#   finer arc, but also more work for your machine. Arcs smaller than
#   the configured value will become straight lines. The default is
#   1mm.

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[led LED_Light]
white_pin: PB9
initial_white: 0.0

[printer]
kinematics: cartesian
max_velocity: 200
max_accel: 3500
max_z_velocity: 25
max_z_accel: 200
square_corner_velocity: 5
# Use those higher values just to configure Input Shaper 
#max_accel: 10000
#max_accel_to_decel: 10000

[stepper_x]
step_pin: !PC12
dir_pin: PB3
enable_pin: !PD2
microsteps: 16
rotation_distance: 40
endstop_pin: PA13
position_endstop: -5.0
position_min: -5
position_max: 330
homing_speed: 60

[stepper_y]
step_pin: PC11
dir_pin: PA15
enable_pin: !PC10
microsteps: 16
rotation_distance: 40
endstop_pin: PB8
position_endstop: 0
position_max: 330
homing_speed: 60

[stepper_z]
step_pin: PC7
dir_pin: !PC9
enable_pin: !PC8
rotation_distance: 8
microsteps: 16
position_min: -2
position_max: 400
endstop_pin: probe:z_virtual_endstop # Use Z- as endstop
homing_speed: 8.0

[extruder]
max_extrude_only_distance: 50.0
max_extrude_cross_section: 5
step_pin: PB10
dir_pin: PB1
enable_pin: !PC6
microsteps: 16
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PA6
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC1
min_temp: -50
max_temp: 280
# Calibrate E-Steps https://www.klipper3d.org/Rotation_Distance.html#calibrating-rotation_distance-on-extruders
rotation_distance: 7.728
# Calibrate PID: https://www.klipper3d.org/Config_checks.html#calibrate-pid-settings
#  - Example: PID_CALIBRATE HEATER=extruder TARGET=200
#control = pid
#pid_kp = 30.356
#pid_ki = 1.857
#pid_kd = 124.081
# Calibrate PA: https://www.klipper3d.org/Pressure_Advance.html
pressure_advance: 0.0320 # 0.4mm nozzle + elegoo pla
#pressure_advance: 0.0180 # 0.8mm nozzle
#pressure_advance: 0.0250 # 0.4mm nozzle + eryone silk 2color

# TUNING_TOWER COMMAND=SET_RETRACTION PARAMETER=RETRACT_LENGTH START=0 FACTOR=0.05
# 0.55 for spectrum pla
[firmware_retraction]
retract_length: 0.7
#   The length of filament (in mm) to retract when G10 is activated,
#   and to unretract when G11 is activated (but see
#   unretract_extra_length below). The default is 0 mm.
retract_speed: 60
#   The speed of retraction, in mm/s. The default is 20 mm/s.
# unretract_extra_length: 0.5
#   The length (in mm) of *additional* filament to add when
#   unretracting.
unretract_speed: 60
#   The speed of unretraction, in mm/s. The default is 10 mm/s.

[heater_bed]
heater_pin: PA5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC0
pwm_cycle_time: 0.0166 # set to 0.0166 if your grid runs on 60Hz to fix lights flickering
max_temp: 110
min_temp: 0
max_power: 0.5 # try to mitigate random shutdowns during printing (Invalid oid type)
# Calibrate PID: https://www.klipper3d.org/Config_checks.html#calibrate-pid-settings
#  - Example: PID_CALIBRATE HEATER=heater_bed TARGET=60
#control = pid
#pid_kp = 64.230
#pid_ki = 0.723
#pid_kd = 1425.905

[heater_fan hotend_fan]
pin: PB0
heater: extruder
heater_temp: 50.0

[fan]
pin: PA7

[filament_switch_sensor filament_sensor]
pause_on_runout: true
switch_pin: PB4

[bed_screws]
screw1: 65, 13
screw1_name: left front screw
screw2: 65, 145
screw2_name: left middle screw
screw3: 65, 280
screw3_name: left back screw
screw4: 318, 13
screw4_name: right front screw
screw5: 318, 145
screw5_name: right middle screw
screw6: 318, 280
screw6_name: right back screw

[screws_tilt_adjust]
screw1: 65, 13
screw1_name: left front screw
screw2: 65, 145
screw2_name: left middle screw
screw3: 65, 280
screw3_name: left back screw
screw4: 318, 13
screw4_name: right front screw
screw5: 318, 145
screw5_name: right middle screw
screw6: 318, 280
screw6_name: right back screw

# Calibrate IS: https://www.klipper3d.org/Resonance_Compensation.html
[input_shaper]
shaper_type_y = 2hump_ei
shaper_freq_y = 47.2
shaper_type_x = mzv
shaper_freq_x = 51.8

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
#min_temp: 10
#max_temp: 105

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
sensor_temperature1: 25
sensor_adc1: 0.210317
#min_temp: 0
#max_temp: 105

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = 1.310
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.164571, -0.118273, -0.088279, -0.085123, -0.073412, -0.071133, -0.064882, -0.038637, -0.054676, -0.043413, -0.057231, -0.050179, -0.033284, -0.064318, -0.061784, -0.079695, -0.091432, -0.081406, -0.079719, -0.064318
#*# 	-0.191612, -0.141308, -0.092316, -0.098623, -0.085123, -0.058640, -0.073412, -0.042563, -0.058083, -0.056379, -0.057333, -0.066326, -0.040876, -0.053266, -0.067154, -0.062634, -0.084262, -0.075128, -0.068015, -0.073436
#*# 	-0.182375, -0.122087, -0.098623, -0.085985, -0.071697, -0.063464, -0.050156, -0.042569, -0.042262, -0.033376, -0.028802, -0.034971, -0.025436, -0.028802, -0.041147, -0.044804, -0.051005, -0.044804, -0.049306, -0.042553
#*# 	-0.151023, -0.106405, -0.052416, -0.062610, -0.047348, -0.037765, -0.019602, -0.008187, 0.007866, -0.007352, -0.004304, -0.004304, 0.012242, 0.009216, -0.007352, 0.000102, -0.017364, -0.000734, -0.024907, -0.018203
#*# 	-0.157494, -0.091452, -0.055548, -0.045683, -0.041706, -0.031042, -0.012665, -0.001252, -0.002629, 0.016105, 0.007032, 0.011436, 0.018307, 0.012264, -0.001252, -0.004304, 0.003146, 0.011413, -0.002923, 0.000957
#*# 	-0.160714, -0.109294, -0.058655, -0.060346, -0.041147, -0.033283, -0.022656, 0.017481, 0.000125, 0.006201, 0.016655, 0.029520, 0.030331, 0.016655, 0.019137, 0.009216, 0.003974, 0.009213, -0.005972, 0.013092
#*# 	-0.170474, -0.109581, -0.063484, -0.060346, -0.031062, -0.022679, -0.022656, 0.009216, 0.009196, 0.024875, 0.022669, 0.023493, 0.019137, 0.012264, -0.001335, -0.003756, 0.005341, 0.020502, -0.001252, 0.007002
#*# 	-0.160713, -0.092292, -0.062622, -0.060903, -0.034994, -0.037764, -0.023496, -0.005972, 0.007013, 0.010046, 0.004537, 0.003451, 0.021840, 0.007866, -0.002090, 0.000125, -0.002090, 0.004537, 0.024343, 0.006198
#*# 	-0.158352, -0.104986, -0.062610, -0.055528, -0.037765, -0.027118, -0.019299, 0.015280, 0.014446, 0.017466, 0.010065, 0.009237, 0.014459, 0.012170, 0.003993, 0.002331, 0.010581, 0.021840, 0.020482, 0.000938
#*# 	-0.132555, -0.082850, -0.043442, -0.045652, -0.034971, -0.026277, -0.014301, 0.005368, 0.007866, 0.008403, 0.008695, 0.019111, 0.010608, 0.012264, 0.000957, 0.000957, -0.002629, 0.007866, 0.018289, 0.011436
#*# 	-0.140719, -0.069723, -0.048457, -0.036368, -0.028802, -0.021817, -0.011787, 0.008403, 0.006198, 0.006201, 0.004825, 0.003993, 0.019118, 0.007032, 0.010046, -0.002090, 0.000125, 0.006198, 0.018837, 0.021308
#*# 	-0.143065, -0.083428, -0.050156, -0.042552, -0.028802, -0.012642, -0.008201, 0.000125, -0.001252, 0.008390, 0.008669, -0.005972, 0.001788, 0.014446, -0.002629, -0.003466, 0.003146, 0.007866, 0.006198, 0.019111
#*# 	-0.132534, -0.077411, -0.036385, -0.025749, -0.015711, -0.031902, -0.019590, 0.000125, -0.011239, 0.013920, -0.008187, -0.010404, 0.006175, -0.001252, 0.010608, -0.010403, 0.003974, 0.004537, 0.002620, 0.004825
#*# 	-0.115108, -0.068608, -0.039455, -0.030199, -0.010426, -0.007369, -0.003485, 0.007013, -0.000734, -0.023220, -0.009568, 0.004808, 0.007839, -0.002629, -0.013459, -0.012709, -0.000439, 0.009216, 0.011410, 0.018837
#*# 	-0.095473, -0.051855, -0.015704, -0.016526, 0.002318, -0.005138, -0.005972, 0.006201, 0.003146, 0.000094, 0.000938, -0.005972, 0.003980, -0.012075, -0.023496, -0.025436, -0.022656, -0.004304, -0.004300, 0.007002
#*# 	-0.077976, -0.040328, -0.018203, -0.005696, -0.008187, -0.005972, -0.004300, 0.005368, 0.000938, -0.017912, -0.016526, -0.019590, -0.017364, -0.006527, -0.028802, -0.028802, -0.032440, -0.018203, -0.001289, -0.004300
#*# 	-0.068889, -0.031045, -0.005138, -0.002923, -0.008201, 0.006198, 0.013616, 0.016655, 0.000125, -0.008187, -0.016526, -0.020429, -0.018203, -0.019590, -0.031042, -0.033284, -0.022679, -0.021817, 0.004537, -0.013459
#*# 	-0.048457, -0.019591, 0.007032, 0.021308, 0.022669, 0.019111, 0.010608, 0.033872, 0.010608, -0.002090, -0.008255, -0.002105, -0.004304, 0.005341, -0.013480, -0.026277, -0.028802, -0.017364, -0.005164, -0.001269
#*# 	-0.035537, 0.018307, 0.037701, 0.045049, 0.023519, 0.019967, 0.036363, 0.028712, 0.015287, 0.006198, 0.009216, -0.008732, 0.003994, 0.004537, -0.008207, -0.002084, -0.027118, -0.013459, -0.003485, -0.003485
#*# 	-0.031041, 0.013089, 0.041532, 0.048024, 0.031715, 0.038228, 0.033055, 0.039873, 0.026509, 0.007032, 0.001788, -0.004304, 0.013618, 0.000957, -0.015139, -0.007369, -0.022656, -0.000439, -0.008732, 0.007839
#*# tension = 0.2
#*# min_x = 20.0
#*# algo = bicubic
#*# y_count = 20
#*# mesh_y_pps = 3
#*# min_y = 30.0
#*# x_count = 20
#*# max_y = 304.93000000000006
#*# mesh_x_pps = 3
#*# max_x = 274.98
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 35.753
#*# pid_ki = 2.678
#*# pid_kd = 119.324
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 69.714
#*# pid_ki = 0.665
#*# pid_kd = 1827.366
#*#
#*# [probe_eddy_ng btt_eddy]
#*# calibrated_drive_currents = 15, 16
#*# calibration_version = 5
#*# reg_drive_current = 15
#*# tap_drive_current = 16
#*# calibration_15 = gASVygMAAAAAAAB9lCiMAXaUSwWMBGZ0b2iUjBtudW1weS5wb2x5bm9taWFsLnBvbHlub21pYWyUjApQb2x5bm9taWFslJOUKYGUfZQojARjb2VmlIwVbnVtcHkuY29yZS5tdWx0aWFycmF5lIwMX3JlY29uc3RydWN0lJOUjAVudW1weZSMB25kYXJyYXmUk5RLAIWUQwFilIeUUpQoSwFLCoWUaAyMBWR0eXBllJOUjAJmOJSJiIeUUpQoSwOMATyUTk5OSv////9K/////0sAdJRiiUNQxnzb4ABQ9j9dhKW3SRn8PyECTwT82OY/ypBmL27X2z8zy2yZI8LXP0m1Bm1Waco/Vcna65c5xr84LZAhFPu/v5bnRuLhkc0/lJJZSWPTxT+UdJRijAZkb21haW6UaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxCW2NkzdWmUPqwCg5J83JQ+lHSUYowGd2luZG93lGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGKMB19zeW1ib2yUjAF4lIwGc3ltYm9slGgsdWKMCWZ0b2hfaGlnaJRoBSmBlH2UKGgIaAtoDksAhZRoEIeUUpQoSwFLCoWUaBiJQ1AIFgBDUncaQLMFH0i5LwhAKu5H60q9+D+TvT87qoAFQLblgOQ7iP0/pIosb7qRE8DhrYcmeTr+v3+jJdFNiRxAOEmCOo2z/T/8uCoJviEEwJR0lGJoHWgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQcfItjwDZlD48YYuDofCUPpR0lGJoJGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGJoK2gsaC1oLHVijARodG9mlGgFKYGUfZQoaAhoC2gOSwCFlGgQh5RSlChLAUsKhZRoGIlDUM740dLxv5Q+OF9BOMwsJz46BIpHBRAavlUXRKegMgs+Mp5l7tDO8b0FSLae6Sn8vTbNPH6HneE9ZyYScxBuAT4fCLXyzwbEvQdiOMGgePC9lHSUYmgdaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxAAYO0HGz+4P4DOs/sO+RNAlHSUYmgkaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxAAAAAAAADwvwAAAAAAAPA/lHSUYmgraCxoLWgsdWKMB2hfcmFuZ2WUXZQoRz+4PxsH7WAAR0At/8BKhFBaZYwHZl9yYW5nZZRdlChHQUhzax8CYABHQUkVVpUuqABljAJkY5RLD3Uu
#*# calibration_16 = gASVygMAAAAAAAB9lCiMAXaUSwWMBGZ0b2iUjBtudW1weS5wb2x5bm9taWFsLnBvbHlub21pYWyUjApQb2x5bm9taWFslJOUKYGUfZQojARjb2VmlIwVbnVtcHkuY29yZS5tdWx0aWFycmF5lIwMX3JlY29uc3RydWN0lJOUjAVudW1weZSMB25kYXJyYXmUk5RLAIWUQwFilIeUUpQoSwFLCoWUaAyMBWR0eXBllJOUjAJmOJSJiIeUUpQoSwOMATyUTk5OSv////9K/////0sAdJRiiUNQ9eUGMVXZ8z/7p01QgKf7P5v+kyHWJeg/SmzdhM2r2T+OxU0RMXPYP3b2MFdsS9Y/2BkoGYPyuL8bZYO+owbFv2pddtATKsw/tmovCtYVyD+UdJRijAZkb21haW6UaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxC1r5ZbV2yUPmWwffUH95Q+lHSUYowGd2luZG93lGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGKMB19zeW1ib2yUjAF4lIwGc3ltYm9slGgsdWKMCWZ0b2hfaGlnaJRoBSmBlH2UKGgIaAtoDksAhZRoEIeUUpQoSwFLCoWUaBiJQ1C8kNtYXWAaQPe8qYOyhQhA91lK22YU+z+pW8xXeiIAQDBDV39Exuk/lC1agVLVCMANeeOxS2PAv0oRrb+HexRAklSrVfw77j/xAml7E5f7v5R0lGJoHWgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQgv4WfB3zlD6UnfK5HAyVPpR0lGJoJGgLaA5LAIWUaBCHlFKUKEsBSwKFlGgYiUMQAAAAAAAA8L8AAAAAAADwP5R0lGJoK2gsaC1oLHVijARodG9mlGgFKYGUfZQoaAhoC2gOSwCFlGgQh5RSlChLAUsKhZRoGIlDUINl/cDe1pQ+sPgz9naoKj4XwWHk2XYgvkJ/cdedxw4+X74EWlYxyb3tcOOXdMPTvU2VPYKqCQK+M6J5LGvr9j2MwroHIBz2PSw9JMPw7O+9lHSUYmgdaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxAAYG1B0/TZPoCL4B8n7BNAlHSUYmgkaAtoDksAhZRoEIeUUpQoSwFLAoWUaBiJQxAAAAAAAADwvwAAAAAAAPA/lHSUYmgraCxoLWgsdWKMB2hfcmFuZ2WUXZQoRz7Z9NNBbWAAR0At///i1qcTZYwHZl9yYW5nZZRdlChHQUhTfkBe4ABHQUkRy/8AKABljAJkY5RLEHUu
